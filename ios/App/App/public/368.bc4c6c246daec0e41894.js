(self.webpackChunkdynamico=self.webpackChunkdynamico||[]).push([[368],{40368:(t,e,o)=>{"use strict";o.r(e),o.d(e,{BackgroundGeolocationWeb:()=>a});var n=o(16304),i=o(68384);let a=(()=>{class t extends i.Uw{constructor(){super(...arguments),this.plannedRoute=[],this.isOffRoute=!0,this.distanceThreshold=50}start(t,e){var o=this;return(0,n.Z)(function*(){navigator.geolocation?o.watchId?e(void 0,{name:"GeolocationError",message:"Geolocation already started",code:"ALREADY_STARTED"}):o.watchId=navigator.geolocation.watchPosition(t=>{const n={latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,altitude:t.coords.altitude,altitudeAccuracy:t.coords.altitudeAccuracy,simulated:!1,bearing:t.coords.heading,speed:t.coords.speed,time:t.timestamp};if(o.audio&&o.plannedRoute.length>0){const e=o.distancePointToRoute([t.coords.longitude,t.coords.latitude])>o.distanceThreshold;1==e&&!1===o.isOffRoute&&o.audio.play(),o.isOffRoute=e}e(n)},t=>{const o={name:"GeolocationError",message:t.message,code:t.code.toString()};e(void 0,o)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:t.stale?3e5:0}):e(void 0,{name:"GeolocationError",message:"Geolocation is not supported by this browser",code:"NOT_SUPPORTED"})})()}stop(){var t=this;return(0,n.Z)(function*(){t.watchId&&(navigator.geolocation.clearWatch(t.watchId),delete t.watchId)})()}openSettings(){return(0,n.Z)(function*(){console.log("openSettings: Web implementation cannot open native settings"),window.alert("Please enable location permissions in your browser settings")})()}setPlannedRoute(t){var e=this;return(0,n.Z)(function*(){if(!t.soundFile)throw new Error("Sound file is required");e.audio&&(e.audio.pause(),e.audio.src="",e.audio=void 0),e.audio=new Audio(t.soundFile),e.plannedRoute=t.route||[],e.distanceThreshold=t.distance||50})()}toRadians(t){return t*Math.PI/180}haversine(e,o){const[n,i]=e,[a,s]=o,r=this.toRadians(s-i),d=this.toRadians(a-n),c=Math.sin(r/2)*Math.sin(r/2)+Math.cos(this.toRadians(i))*Math.cos(this.toRadians(s))*Math.sin(d/2)*Math.sin(d/2),u=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));return t.EARTH_RADIUS_M*u}distancePointToLineSegment(t,e,o){const n=this.haversine(t,e),i=this.haversine(t,o),a=this.haversine(e,o);if(0===a)return n;if((n**2+a**2-i**2)/(2*n*a+Number.EPSILON)<0)return n;if((i**2+a**2-n**2)/(2*i*a+Number.EPSILON)<0)return i;const s=(n+i+a)/2;return 2*Math.sqrt(Math.max(0,s*(s-n)*(s-i)*(s-a)))/(a+Number.EPSILON)}distancePointToRoute(t){if(this.plannedRoute.length<2)return 1===this.plannedRoute.length?this.haversine(t,this.plannedRoute[0]):1/0;let e=1/0;for(let o=0;o<this.plannedRoute.length-1;o++){const n=this.distancePointToLineSegment(t,this.plannedRoute[o],this.plannedRoute[o+1]);n<e&&(e=n)}return e}getPluginVersion(){return(0,n.Z)(function*(){return{version:"web"}})()}}return t.EARTH_RADIUS_M=6371e3,t})()}}]);